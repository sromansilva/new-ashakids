<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{fragments/terapeutaLayout :: Head}"></head>

<body>

<!--SIDEBAR-->
  <div th:replace="~{fragments/terapeutaLayout :: menuToggle}"></div>

  <nav th:replace="~{fragments/terapeutaLayout :: sidebarTerapeuta}"></nav>

  <div th:replace="~{fragments/terapeutaLayout :: overlay}"></div>


  <main class="content-area">
    <!-- Header llamativo -->
    <div class="agenda-header">
      <div class="row align-items-center">
        <div class="col-md-8">
          <h1 class="display-6 fw-bold mb-2">üóìÔ∏è Agenda del Terapeuta</h1>
          <p class="mb-0 fs-5 opacity-90">Gestiona tus citas y sesiones de terapia</p>
        </div>
        <div class="col-md-4 text-md-end">
          <div class="d-flex align-items-center justify-content-md-end">
            <div class="me-3">
              <div class="fw-bold fs-4" th:text="${#lists.size(citas)}">0</div>
              <div class="small opacity-75">Citas programadas</div>
            </div>
            <div class="bg-white bg-opacity-20 rounded-circle d-flex align-items-center justify-content-center" style="width: 60px; height: 60px;">
              <i class="fas fa-calendar-alt fs-3"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Estado vac√≠o -->
    <div th:if="${#lists.isEmpty(citas)}">
      <div class="empty-state">
        <div class="mb-4">
          <div class="bg-light rounded-circle d-inline-flex align-items-center justify-content-center" style="width: 120px; height: 120px;">
            <i class="fas fa-calendar-times text-muted" style="font-size: 3rem;"></i>
          </div>
        </div>
        <h3 class="fw-bold mb-3" style="color: #1976d2;">¬°No tienes citas programadas!</h3>
        <p class="text-muted fs-5 mb-4">Cuando tengas citas agendadas, aparecer√°n aqu√≠ para que puedas gestionarlas f√°cilmente.</p>
        <button class="btn btn-primary btn-lg px-4 py-2" style="background: linear-gradient(135deg, #1976d2 0%, #42a5f5 100%); border: none;">
          <i class="fas fa-plus me-2"></i>Agendar nueva cita
        </button>
      </div>
    </div>

    <!-- Lista de citas -->
    <div th:if="${!#lists.isEmpty(citas)}">
      <div class="row g-4">
        <div th:each="cita : ${citas}" class="col-12 col-lg-6">
          <div class="cita-card">
            <!-- T√≠tulo de la cita (tema) -->
            <div class="mb-3">
              <h5 class="fw-bold text-primary mb-1" th:text="${cita.tema != null ? cita.tema : 'Cita de Terapia'}">Cita de Terapia</h5>
              <p class="text-muted mb-0" th:text="${cita.retroalimentacion_padre != null ? 'Tutor: ' + cita.retroalimentacion_padre : 'Tutor: No especificado'}">Tutor</p>
            </div>

            <!-- Fecha y hora destacadas -->
            <div class="date-time">
              <div class="row align-items-center">
                <div class="col-8">
                  <h6 class="fw-bold mb-1" th:text="${cita.fecha != null ? #temporals.format(cita.fecha, 'EEEE, d MMMM yyyy') : 'Sin fecha'}">Fecha</h6>
                  <p class="mb-0 text-primary fw-semibold" th:text="${cita.hora != null ? cita.hora : 'Sin hora'}">Hora</p>
                </div>
                <div class="col-4 text-end">
                  <span class="status-badge" th:classappend="${cita.estado == 'Confirmada' ? 'bg-confirmada' : cita.estado == 'Pendiente' ? 'bg-pendiente' : cita.estado == 'programada' ? 'bg-programada' : ''}" 
                        th:text="${cita.estado != null ? cita.estado : 'Sin estado'}">Estado</span>
                </div>
              </div>
            </div>

            <!-- Informaci√≥n del paciente -->
            <div class="row mb-3">
              <div class="col-12">
                <div class="d-flex align-items-center mb-2">
                  <div class="bg-primary bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 40px; height: 40px;">
                    <i class="fas fa-user text-primary"></i>
                  </div>
                  <div>
                    <h6 class="fw-bold mb-0" th:text="${cita.nino != null && cita.nino.nombre != null ? cita.nino.nombre : 'Sin asignar'}">Nombre Ni√±o</h6>
                    <small class="text-muted">Paciente</small>
                  </div>
                </div>
              </div>
            </div>

            <!-- Detalles de la cita -->
            <div class="row g-3 mb-3">
              <div class="col-6">
                <div class="d-flex align-items-center">
                  <i class="fas fa-video text-info me-2"></i>
                  <div>
                    <small class="text-muted d-block">Modalidad</small>
                    <span class="fw-semibold" th:text="${cita.modalidad != null ? cita.modalidad : 'Sin modalidad'}">Modalidad</span>
                  </div>
                </div>
              </div>
              <div class="col-6">
                <div class="d-flex align-items-center">
                  <i class="fas fa-map-marker-alt text-danger me-2"></i>
                  <div class="link-container">
                    <small class="text-muted d-block">Ubicaci√≥n</small>
                    <span class="fw-semibold link-text" th:text="${cita.enlace_o_direccion != null ? cita.enlace_o_direccion : 'Sin enlace o direcci√≥n'}">Ubicaci√≥n</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Botones de acci√≥n seg√∫n modalidad -->
            <div class="d-flex gap-2">
              <!-- Bot√≥n Zoom solo para citas virtuales -->
              <button th:if="${cita.modalidad == 'Virtual' && cita.enlace_o_direccion != null}" 
                      class="btn btn-zoom flex-fill"
                      th:data-zoom-link="${cita.enlace_o_direccion}"
                      onclick="window.open(this.getAttribute('data-zoom-link'), '_blank')">
                <i class="fas fa-video me-2"></i>Unirse al Zoom
              </button>
              
              <!-- Aviso para citas presenciales -->
              <div th:if="${cita.modalidad == 'Presencial'}" 
                   class="btn btn-warning flex-fill" 
                   style="background: linear-gradient(135deg,#ff9800 0%,#ffb74d 100%); border: none; color: white; font-weight: 600; cursor: default;">
                <i class="fas fa-building me-2"></i>Cita en Sede
              </div>
              
              <!-- Bot√≥n cancelar -->
              <button class="btn btn-cancel flex-fill cancelar-cita-btn" th:data-cita-id="${cita.id_cita}">
                <i class="fas fa-times me-2"></i>Cancelar
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

    <div th:replace="~{fragments/terapeutaLayout :: terapeuta-scripts}"></div>
</body>
</html>
